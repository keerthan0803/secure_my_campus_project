extends layout

block content
  .navbar
    .logo-container
      img(src="/images/Campus.png", alt="Secure My Campus Logo")
      div
        span(style="font-size:22px;font-weight:bold;color:#007bff;") Secure
        span(style="font-size:16px;color:#333;letter-spacing:1px;") My Campus
    .nav-links
      a(href="/") Home
      a(href="/complaint") Complaint Box
      if email
        a(href="/form") Form Page
        a(href="/help") Help Center
        a(href="/profile", title="Profile") Profile
      if !email
        a(href="/users/signup") Sign Up
        a(href="/users/signin") Sign In
    .profile-top-right
      if email
        a(href="/profile", title="Profile")
          img(src="/images/profile.png", alt="Profile", style="width:40px;height:40px;border-radius:50%;background:#eee;")
  h1= typeof title !== 'undefined' ? title : 'Complaint Page'
  if complaints && complaints.length
  // Filter dropdown top right
  .filter-bar(style='display:flex; justify-content:flex-end; align-items:center; margin-bottom:20px;')
    form(method='GET', action='/complaint', style='display:flex; align-items:center;')
      label(for='category', style='margin-right:8px; font-weight:bold;') Category:
      select(name='category', id='category', onchange='this.form.submit()', style='padding:4px 8px;')
        option(value='') All
        if categories
          each cat in categories
            option(value=cat, selected=(selectedCategory==cat)?true:false)= cat
  if complaints && complaints.length
    .complaints-container
        each complaint, i in complaints
          .complaint-box(style=`border-color:${complaint.color||'red'};`)
            // ...removed top right timer...
            h3= complaint.name
            p Email: #{complaint.email}
            p Category: #{complaint.category}
            p Location: #{complaint.location}
            p Description: #{complaint.description}
            if complaint.photo
              img(src=complaint.photo, alt='Photo', style='max-width:200px;max-height:200px;')
            p Date: #{complaint.date}
            if complaint.expiresAt
              - var secondsLeft = Math.max(0, Math.floor((complaint.expiresAt - now) / 1000));
              - var days = Math.floor(secondsLeft / (24 * 60 * 60));
              - var mins = Math.floor((secondsLeft % (24 * 60 * 60)) / 60);
              - var secs = secondsLeft % 60;
              if secondsLeft > 0
                .timer(style='font-weight:bold; color:#d9534f; margin-bottom:8px;')
                  | Time left: #{days} days #{mins} min #{secs} sec
              else
                .timer(style='font-weight:bold; color:#d9534f; margin-bottom:8px;')
                  | Expired
            form(method='POST', action='/change-complaint-color', style='display:inline-block; margin-top:10px; margin-right:10px;')
              input(type='hidden', name='index', value=i)
              button(type='submit', class='btn btn-success')
                span Mark as Green
            form(method='POST', action='/delete-complaint', style='display:inline-block; margin-top:10px;', onsubmit="return confirm('Are you sure you want to delete this complaint?');")
              input(type='hidden', name='index', value=i)
              button(type='submit', class='btn btn-danger')
                span Delete
style.
  .complaint-box {
    border: 4px solid red;
    /* ...existing styles... */
  }
                | Time left: #{Math.floor(secondsLeft/60)}m #{secondsLeft%60}s
  else
    p No complaints submitted yet.
footer
  p
    | Â© 2025 Secure My Campus |
    a(href="#") Privacy Policy
    |  |
    a(href="#") Help Center
  